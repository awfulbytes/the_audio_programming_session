/*
this is the way to save main funcs
*/
// nscale main shit
#include <stdio.h>
#include "nscale.h"

int main(int argc, char* argv[]) {
    if (argc != 3) {
        printf("usage: ./nscale notes_quant_per_OCT midinote_code\n");
        printf("usage: ________ ----1 ...... 24---- ____0-127____\n");
        printf("\n");
        return 1;
    }

    int notes, midinote;

    notes = atoi(argv[1]);

    if (notes < 1) {
        printf("Error: Notes number must be positive and bigger than 0\n");
        return 1;
    }

    if (notes > 24) {
        printf("Error: Notes number must be at max = 24\n");
        return 1;
    }

    midinote = atoi(argv[2]);

    if (midinote < 0) {
        printf("Error: Cannot have negative Midi Notes!\n");
        return 1;
    }

    if (midinote > 127) {
        printf("Error: Maximum Midi Note is 127\n");
        return 1;
    }

    scaler(notes, midinote);
    return 0;
}

// breakpoint main func

#include <stdlib.h>
#include <stdio.h>
#include "brkpnt.h"

int main(int argc, char* argv[]) {
    long size;
    double dur;
    brkpnt_t point, *points;
    FILE* fp;

    printf("breakdur: find the duration of breakpoint file\n");

    if (argc < 2) {
        printf("usage: <bin_name> infile.txt \n");
        return 0;
    }

    fp = fopen(argv[1], "r");
    if (fp == NULL) {
        return 0;
    }

    size = 0;
    points = get_brkpnts(fp, &size);
    if (points == NULL) {
        printf("No breakpoints in the file\n");
        fclose(fp);
        return 1;
    }
    if (size < 2) {
        printf("Error: at least 2 breakpoints are required\n");
        free(points);
        fclose(fp);
        return 1;
    }

    // NOTE: breakpoints need to start at 0
    if (points[0].time != 0.0) {
        printf("Error: in datapoints: time must start @0.0\n");
        free(points);
        fclose(fp);
        return 1;
    }
    printf("read %.2ld breakpoints\n", size);

    dur = points[size - 1].time;
    printf("duration: %f seconds\n", dur);

    point = maxpoint(points, size);
    printf("max value: %f at %f seconds\n", point.value, point.time);
    free(points);
    fclose(fp);
    return 0;
}
